"use strict";(globalThis["webpackChunkbabeltalk"]=globalThis["webpackChunkbabeltalk"]||[]).push([[203],{6203:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var o=i(9835),a=i(1957),n=i(6970);const s={class:"row text-center"},r={class:"col-12 text-center",id:"disable-record-div"},l=(0,o._)("img",{src:"icons/icon-transparent-large.png"},null,-1),d={class:"col-12 text-center q-mt-md",id:"message-div"};function c(e,t,i,c,u,g){const m=(0,o.up)("q-spinner-audio"),p=(0,o.up)("q-toggle"),f=(0,o.up)("q-avatar"),w=(0,o.up)("q-btn"),h=(0,o.up)("q-item-label"),b=(0,o.up)("q-item-section"),v=(0,o.up)("q-item"),_=(0,o.up)("q-page"),k=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(_,{class:"q-pa-md"},{default:(0,o.w5)((()=>[(0,o._)("div",s,[(0,o.Wm)(a.uT,{"enter-active-class":"animated fadeInDown","leave-active-class":"animated fadeOutUp"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",r,[(0,o.Wm)(m,{color:"primary",size:"5em",id:"audio-spinner"}),(0,o.Wm)(p,{modelValue:u.recordVal,"onUpdate:modelValue":t[0]||(t[0]=e=>u.recordVal=e),color:"green",size:"5em"},null,8,["modelValue"])],512),[[a.F8,u.showDisableRecord]])])),_:1}),(0,o.Wm)(a.uT,{"enter-active-class":"animated fadeInDown","leave-active-class":"animated fadeOutUp"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(w,{round:"",glossy:"",style:{"margin-left":"auto","margin-right":"auto",background:"#e7e5ff"},onClick:g.toggleRecording},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{size:u.buttonSize+"px"},{default:(0,o.w5)((()=>[l])),_:1},8,["size"])])),_:1},8,["onClick"]),[[a.F8,u.showEnableRecord]])])),_:1}),(0,o._)("div",d,[(0,o.Wm)(a.W3,{name:"list-complete",tag:"q-list"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(u.textData,(e=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(v,{clickable:"",key:e.id,class:"list-complete-item",style:(0,n.j5)({"border-color":e.srcLangColor})},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"message-text"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.text_tgt),1)])),_:2},1024),(0,o.Wm)(h,{caption:"",class:"message-caption"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.text_src),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["style"])),[[k]]))),128))])),_:1})])])])),_:1})}i(3382);var u=i(3819),g=i(9302),m=i(7779);let p={zh:"#27b12b",ZH:"#27b12b",en:"#9595eb",EN:"#9595eb"};const f={data(){return{audioSpinner:null,recordVal:!1,recordAudio:null,socketio:null,timeSlice:100,ipAddress:"https://wetalk.iamohcy.com:3000",textData:[],receiveBuffer:[],processBufferInterval:null,waitingForAudioToEnd:!1,showEnableRecord:!0,showDisableRecord:!1,messageIdx:0,isMobile:!1,buttonSize:450,debugDataIdx:0,debugInterval:null}},setup(){},mounted(){const e=(0,g.Z)();this.isMobile=e.platform.is.mobile,this.isMobile&&(this.buttonSize=300);var t=this;let i=document.createElement("script");i.setAttribute("src","https://www.WebRTC-Experiment.com/RecordRTC.js"),document.head.appendChild(i),this.audioSpinner=document.getElementById("audio-spinner"),this.audioSpinner.pauseAnimations(),this.init(),this.processBufferInterval=window.setInterval((()=>{if(t.receiveBuffer.length>0)if(m.log(t.receiveBuffer.length),t.waitingForAudioToEnd)m.log("Waiting for current audio to end...");else{t.waitingForAudioToEnd=!0;let e=t.receiveBuffer.shift(),i=e["language_src"],o=e["language_tgt"],a=e["text_src"],n=e["text_tgt"],s=e["speech_tgt"],r=new AudioContext({sampleRate:16e3});r.decodeAudioData(s).then((e=>{var i=r.createBufferSource();i.buffer=e,i.connect(r.destination),i.start(),i.onended=()=>{t.waitingForAudioToEnd=!1}}));let l={language_src:i,language_tgt:o,text_src:a,text_tgt:n,srcLangColor:p[i],id:t.messageIdx};t.messageIdx++,t.textData.unshift(l)}}),100)},methods:{init(){var e=this;null!=e.socketio&&(m.log("disconnect!"),e.socketio.disconnect()),m.log(e.ipAddress),e.socketio=(0,u.io)(e.ipAddress),e.socketio.on("connect",(function(t){m.log("CONNECTED"),e.recordVal=!1})),e.socketio.on("disconnect",(function(t){m.log("DISCONNECTED"),e.recordVal=!1,e.receiveBuffer=[]})),e.socketio.on("translated",(function(t){t["status"]&&"ok"==t["status"]?e.receiveBuffer.unshift(t):m.log("Some thing is wrong!!")}))},toggleRecording(){this.recordVal=!this.recordVal}},watch:{recordVal(e,t){let i=this;1==e?(i.showEnableRecord=!1,i.showDisableRecord=!0,i.audioSpinner.unpauseAnimations(),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{i.recordAudio=RecordRTC(e,{type:"audio",mimeType:"audio/wav",desiredSampRate:16e3,recorderType:StereoAudioRecorder,numberOfAudioChannels:1,timeSlice:i.timeSlice,ondataavailable:function(e){i.socketio.emit("audio",e)}}),i.recordAudio.startRecording()}),(function(e){m.error(JSON.stringify(e))}))):(i.showDisableRecord=!1,i.receiveBuffer=[],window.setTimeout((()=>{i.showEnableRecord=!0}),300),i.audioSpinner.pauseAnimations(),i.recordAudio.stopRecording((function(){})))}}};var w=i(1639),h=i(9885),b=i(6556),v=i(9379),_=i(5918),k=i(592),A=i(1357),R=i(3246),x=i(490),S=i(1233),T=i(3115),C=i(1136),D=i(9984),E=i.n(D);const I=(0,w.Z)(f,[["render",c]]),y=I;E()(f,"components",{QPage:h.Z,QInput:b.Z,QBtn:v.Z,QSpinnerAudio:_.Z,QToggle:k.Z,QAvatar:A.Z,QList:R.Z,QItem:x.Z,QItemSection:S.Z,QItemLabel:T.Z}),E()(f,"directives",{Ripple:C.Z})}}]);