(globalThis["webpackChunkbabeltalk"]=globalThis["webpackChunkbabeltalk"]||[]).push([[311],{5379:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var o=i(9835),a=i(6970);const n={class:"row text-center"},l={class:"col-12"},r={class:"flex",style:{width:"400px","margin-left":"auto","margin-right":"auto"}},d={class:"flex",style:{width:"400px","margin-left":"auto","margin-right":"auto"}},s={class:"col-12 text-center"},u={class:"col-12 text-center q-mt-md"};function c(e,t,i,c,m,p){const g=(0,o.up)("q-input"),f=(0,o.up)("q-btn"),h=(0,o.up)("q-spinner-audio"),w=(0,o.up)("q-toggle"),v=(0,o.up)("q-item-label"),b=(0,o.up)("q-item-section"),A=(0,o.up)("q-item"),_=(0,o.up)("q-list"),k=(0,o.up)("q-page"),x=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(k,{class:"q-pa-md"},{default:(0,o.w5)((()=>[(0,o._)("div",n,[(0,o._)("div",l,[(0,o._)("div",r,[(0,o.Wm)(g,{modelValue:m.ipAddress,"onUpdate:modelValue":t[0]||(t[0]=e=>m.ipAddress=e),label:"IP Address",class:"q-ma-md"},null,8,["modelValue"]),(0,o.Wm)(f,{color:"primary",icon:"sync",label:"Set IP",class:"q-ma-md",onClick:p.init},null,8,["onClick"])])]),(0,o._)("div",d,[(0,o.Wm)(g,{modelValue:m.timeSlice,"onUpdate:modelValue":t[1]||(t[1]=e=>m.timeSlice=e),modelModifiers:{number:!0},type:"number",label:"Time Slice",class:"q-ma-md"},null,8,["modelValue"])]),(0,o._)("div",s,[(0,o.Wm)(h,{color:"primary",size:"2em",id:"audio-spinner"}),(0,o.Wm)(w,{modelValue:m.recordVal,"onUpdate:modelValue":t[2]||(t[2]=e=>m.recordVal=e),color:"green"},null,8,["modelValue"])]),(0,o._)("div",u,[(0,o.Wm)(_,{bordered:"",separator:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(m.textData,(e=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(A,{clickable:"",key:e.id},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.text_tgt),1)])),_:2},1024),(0,o.Wm)(v,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.text_src),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[x]]))),128))])),_:1})])])])),_:1})}i(3382);var m=i(3819),p=(i(7632),i(7779));const g={data(){return{audioSpinner:null,recordVal:!1,recordAudio:null,socketio:null,timeSlice:1e3,ipAddress:"https://wetalk.iamohcy.com:3000",textData:[],receiveBuffer:[],processBufferInterval:null,waitingForAudioToEnd:!1,debugDataIdx:0,debugInterval:null}},mounted(){var e=this;let t=document.createElement("script");t.setAttribute("src","https://www.WebRTC-Experiment.com/RecordRTC.js"),document.head.appendChild(t),this.audioSpinner=document.getElementById("audio-spinner"),this.audioSpinner.pauseAnimations(),this.init(),this.processBufferInterval=window.setInterval((()=>{if(e.receiveBuffer.length>0)if(p.log(e.receiveBuffer.length),e.waitingForAudioToEnd)p.log("Waiting for current audio to end...");else{e.waitingForAudioToEnd=!0;let t=e.receiveBuffer.shift(),i=t["language_src"],o=t["language_tgt"],a=t["text_src"],n=t["text_tgt"],l=t["speech_tgt"],r=new AudioContext({sampleRate:16e3});r.decodeAudioData(l).then((t=>{var i=r.createBufferSource();i.buffer=t,i.connect(r.destination),i.start(),i.onended=()=>{e.waitingForAudioToEnd=!1}}));let d={language_src:i,language_tgt:o,text_src:a,text_tgt:n};e.textData.push(d)}}),200)},methods:{init(){var e=this;null!=e.socketio&&(p.log("disconnect!"),e.socketio.disconnect()),p.log(e.ipAddress),e.socketio=(0,m.io)(e.ipAddress),e.socketio.on("connect",(function(t){p.log("CONNECTED"),e.recordVal=!1})),e.socketio.on("translated",(function(t){t["status"]&&"ok"==t["status"]?e.receiveBuffer.push(t):p.log("Some thing is wrong!!")}))}},watch:{recordVal(e,t){let i=this;1==e?(i.audioSpinner.unpauseAnimations(),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{i.recordAudio=RecordRTC(e,{type:"audio",mimeType:"audio/wav",desiredSampRate:16e3,recorderType:StereoAudioRecorder,numberOfAudioChannels:1,timeSlice:i.timeSlice,ondataavailable:function(e){i.socketio.emit("audio",e)}}),i.recordAudio.startRecording()}),(function(e){p.error(JSON.stringify(e))}))):(this.audioSpinner.pauseAnimations(),i.recordAudio.stopRecording((function(){})))}}};var f=i(1639),h=i(9885),w=i(6556),v=i(9379),b=i(5918),A=i(592),_=i(3246),k=i(490),x=i(1233),S=i(3115),q=i(1136),y=i(9984),T=i.n(y);const V=(0,f.Z)(g,[["render",c]]),C=V;T()(g,"components",{QPage:h.Z,QInput:w.Z,QBtn:v.Z,QSpinnerAudio:b.Z,QToggle:A.Z,QList:_.Z,QItem:k.Z,QItemSection:x.Z,QItemLabel:S.Z}),T()(g,"directives",{Ripple:q.Z})},2361:()=>{},4616:()=>{}}]);